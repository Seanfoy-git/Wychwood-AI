---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SchemaArticle from "../../components/SchemaArticle.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const items = await getCollection("case-studies");
  return items
    .filter((x) => !x.data.draft)
    .map((x) => ({ params: { slug: x.slug } }));
}

const slug = Astro.params.slug as string;
const entry = await getEntryBySlug("case-studies", slug);
if (!entry) throw new Error(`Case study not found: ${slug}`);

const { Content } = await entry.render();
const path = `/case-studies/${entry.slug}/`;

const kicker = `${entry.data.industry ?? "Case study"}${
  entry.data.stage ? ` • ${entry.data.stage}` : ""
}`;

const outcomes = (entry.data.outcomes ?? []) as string[];
const hasOutcomes = outcomes.length > 0;
---

<BaseLayout
  title={`${entry.data.title} — Case Study — Wychwood Partners`}
  description={entry.data.description}
  canonicalPath={path}
  ogType="article"
>
  <SchemaArticle
    headline={entry.data.title}
    description={entry.data.description}
    urlPath={path}
    datePublished={entry.data.publishDate}
    dateModified={entry.data.updatedDate}
    authorName="Wychwood Partners"
  />

  <main class="shell py-14 max-w-3xl">
    <p class="kicker">{kicker}</p>

    <h1 class="mt-3">{entry.data.title}</h1>
    <p class="mt-4 text-lg text-[rgb(var(--text-muted))]">
      {entry.data.description}
    </p>

    {hasOutcomes ? (
      <div class="mt-6 card p-4">
        <p class="kicker">Outcomes</p>
        <ul class="mt-2 space-y-1 text-sm text-[rgb(var(--text-muted))]">
          {outcomes.map((o: string) => (
            <li>• {o}</li>
          ))}
        </ul>
      </div>
    ) : null}

    <article class="prose case-study mt-10 max-w-none">
      <Content />
    </article>

    <div class="mt-10">
      <a
        class="text-sm font-medium text-[rgb(var(--text))] hover:underline"
        href="/case-studies/"
      >
        ← Back to case studies
      </a>
    </div>
  </main>
</BaseLayout>