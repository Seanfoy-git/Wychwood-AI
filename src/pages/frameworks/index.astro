---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const frameworksAll = (await getCollection("frameworks"))
  .filter((f) => !f.data.draft)
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));

// Safety: de-dupe in case two entries end up with the same effective slug/title.
const frameworks = Array.from(new Map(frameworksAll.map((f) => [f.slug, f])).values());
---

<BaseLayout
  title="Frameworks — Wychwood Partners"
  description="Operating frameworks for execution discipline."
>
  <main class="shell py-14">
    <header class="max-w-3xl">
      <h1>Frameworks</h1>
      <p class="mt-4 text-lg text-[rgb(var(--text-muted))]">
        The core operating systems we install—written plainly so you can apply them.
      </p>
    </header>

    {frameworks.length === 0 ? (
      <div class="mt-10 card p-6">
        <p class="text-sm font-semibold">No frameworks found yet</p>
        <p class="mt-2 text-sm text-[rgb(var(--text-muted))]">
          Add MDX files to <code>src/content/frameworks</code> with frontmatter: <code>title</code>,
          <code>description</code>, <code>publishDate</code>.
        </p>
      </div>
    ) : (
      <div class="mt-10 grid grid-cols-1 gap-6 md:grid-cols-3">
        {frameworks.map((f) => (
          <a
            href={`/frameworks/${f.slug}/`}
            class="group card p-6 transition hover:shadow-md"
          >
            <p class="text-xs font-medium text-[rgb(var(--text-muted))]">
              {f.data.frameworkName ?? "Framework"}
            </p>
            <p class="mt-2 text-lg font-semibold">{f.data.title}</p>
            <p class="mt-2 text-sm text-[rgb(var(--text-muted))]">{f.data.description}</p>
            <p class="mt-4 text-sm font-medium text-[rgb(var(--text))] group-hover:underline">
              Read →
            </p>
          </a>
        ))}
      </div>
    )}
  </main>
</BaseLayout>