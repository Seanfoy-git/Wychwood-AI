import BaseLayout from "../../layouts/BaseLayout.astro";
import SchemaArticle from "../../components/SchemaArticle.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const items = await getCollection("frameworks");
  return items
    .filter((x) => !x.data.draft)
    .map((x) => ({ params: { slug: x.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("frameworks", slug!);
if (!entry) throw new Error(`Framework not found: ${slug}`);

const { Content } = await entry.render();
const path = `/frameworks/${entry.slug}/`;
---

<BaseLayout
  title={`${entry.data.title} — Wychwood Partners`}
  description={entry.data.description}
  canonicalPath={path}
  ogType="article"
>
  <SchemaArticle
    headline={entry.data.title}
    description={entry.data.description}
    urlPath={path}
    datePublished={entry.data.publishDate}
    dateModified={entry.data.updatedDate}
    authorName="Wychwood Partners"
  />

  <main class="mx-auto max-w-3xl px-6 py-14">
    <p class="text-xs font-medium text-slate-500">
      {entry.data.frameworkName ?? "Framework"}
    </p>
    <h1 class="mt-3 text-4xl font-semibold tracking-tight">{entry.data.title}</h1>
    <p class="mt-4 text-lg text-slate-600">{entry.data.description}</p>

    <article class="prose prose-slate mt-10 max-w-none">
      <Content />
    </article>

    <div class="mt-10">
      <a class="text-sm font-medium text-slate-900 hover:underline" href="/frameworks/">
        ← Back to frameworks
      </a>
    </div>
  </main>
</BaseLayout>